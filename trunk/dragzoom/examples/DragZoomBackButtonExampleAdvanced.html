<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xHTML1/DTD/xHTML1-strict.dtd">
<HTML xmlns="http://www.w3.org/1999/xHTML" xmlns:v="urn:schemas-microsoft-com:vml">

  <head>
    <style type="text/css">v\:* {behavior:url(#default#VML);}</style>
     <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Google Maps JavaScript API Example</title>

<style>		
A:link  {text-decoration:none;color:Black}
A:visited  {text-decoration:none;color:Black}
A:active  {text-decoration:none;color:Black}
A:hover  {text-decoration:none;color:Red}

.Label  {
  display: block;
  background-color:white;
  border:2px solid red;
  font-family: Ariel;
  font-size: 12pt;
  font-weight: bold;
  white-space: nowrap;
  opacity: .85;
  cursor: pointer
}
</style>

    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAjU0EJWnWPMv7oQ-jjS7dYxQGj0PqsCtxKvarsoS-iqLdqZSKfxRdmoPmGl7Y9335WLC36wIGYa6o5Q" type="text/javascript"></script>
    <script src="../src/dragzoom.js" type="text/javascript"></script>
    <script src="./scripts/markermanager.js"></script>
    <script src="./scripts/elabels.js" type="text/javascript"></script>
    <script type="text/javascript">

    //<![CDATA[

    // Globals
    var map;
    var DragZoom;
    var mapCenter = new GLatLng(40.72, -73.95);
    var mapZoom = 9;
    var markerMgr;

    var boroughs = [
      {"name":"Bronx",         "lat":40.87, "lng":-73.88, "zoom":13}, 
      {"name":"Manhattan",     "lat":40.78, "lng":-73.97, "zoom":13},
      {"name":"Queens",        "lat":40.72, "lng":-73.83, "zoom":13}, 
      {"name":"Brooklyn",      "lat":40.66, "lng":-73.94, "zoom":13}, 
      {"name":"Staten Island", "lat":40.57, "lng":-74.15, "zoom":13}
    ]
    var parks = [
      {"name":"Van Cortland Park", "lat":40.895, "lng":-73.89}, 
      {"name":"Bronx Park",        "lat":40.86,  "lng":-73.875}, 
      {"name":"Central Park",      "lat":40.775, "lng":-73.9675},
      {"name":"Morningside Park",  "lat":40.8075, "lng":-73.9575},
      {"name":"Flushing Meadows",  "lat":40.745, "lng":-73.845}, 
      {"name":"Forest Park",       "lat":40.705, "lng":-73.845}, 
      {"name":"Prospect Park",     "lat":40.66,  "lng":-73.97}, 
      {"name":"Carnarsie Park",    "lat":40.6275, "lng":-73.8975}, 
      {"name":"Great Kills Park",  "lat":40.545, "lng":-74.125},
      {"name":"Fresh Kills Park",  "lat":40.585, "lng":-74.175}
    ]

    var parkIcon = new GIcon();
    parkIcon.shadow = 'mm_34_shadow.png';
    parkIcon.iconSize = new GSize(20, 34);
    parkIcon.shadowSize = new GSize(37, 34);
    parkIcon.iconAnchor = new GPoint(10, 34);
    parkIcon.infoWindowAnchor = new GPoint(9, 2);
    parkIcon.image = 'mm_34_green.png';

    // Function to put a label for each of the 5 borough's of New York City on the map
    function addBoroughLabels() {
      var boroughLabels = [];
      for (var j in boroughs) {
        var boroughVars = boroughs[j];
        var lat = boroughVars["lat"];
        var lng =  boroughVars["lng"];
        var name =  boroughVars["name"];
        var zoom =  boroughVars["zoom"];
        var nameOffset = - name.length*2 -20;
        var point = new GLatLng(lat,lng);
        var text = '<a href="javascript:saveContextAndZoom(\''+lat+'\', \''+lng+'\', \''+zoom+'\', \''+name+'\')">&nbsp;'+name+'&nbsp;</a>';
        var boroughLabel = new ELabel(point,text,'Label',new GSize(nameOffset,10));
        boroughLabels.push(boroughLabel);
      }
      var minZoom = mapZoom + 1; var maxZoom = minZoom + 2;
      markerMgr.addMarkers(boroughLabels,minZoom,maxZoom);
    }

    // Function to put a marker for each of the 5 borough's major parks on the map
    function addParkMarkers() {
      var parkMarkers = [];
      for (var j in parks) {
        var parkVars = parks[j];
        var lat = parkVars["lat"];
        var lng =  parkVars["lng"];
        var name =  parkVars["name"];
        var point = new GLatLng(lat,lng);
        var parkMarker = new GMarker(point,parkIcon);
        parkMarkers.push(parkMarker);
        addListeners(parkMarker, name) 
      }
      var minZoom = mapZoom + 4; 
      markerMgr.addMarkers(parkMarkers,minZoom);
    }

    // function to add listeners for the markers
    function addListeners(marker, name) {
      GEvent.addListener(marker, "click", function() {
        map.closeInfoWindow();
        var textHTML ='<b>'+name+'</b>';
        marker.openInfoWindowHtml(textHTML);
      });

      return marker; 
    }

    // Function to save the map context vis the DragZoomControl method and then zoom in to the (lat,lng)
    function saveContextAndZoom(lat,lng,zoom,name) {
      buttonText = name+' Zoom Back';
      DragZoom.saveMapContext(buttonText);
      map.setCenter(new GLatLng(lat,lng),parseInt(zoom));
    }

    // Function called after the map context is restored for the borough zoom back
    function restoreContextCallback(methodCall) {
      if (methodCall) map.closeInfoWindow();  // "methodCall" indicates this particular restore was for 
    }                                         // a zoom called by the method, not the DragZoom button

    function load() {
      if (GBrowserIsCompatible()) {
        map = new GMap2(document.getElementById("map"));
        map.setCenter(mapCenter, mapZoom);

        markerMgr = new MarkerManager(map);

        var otherOpts = {
          buttonStartingStyle: {display:"block",color:"black",background:"white",width:"7em",textAlign:"center",
            fontFamily:"Verdana",fontSize:"12px",fontWeight:"bold",border:"1px solid gray",cursor:"pointer"},
          buttonHTML: "Drag Zoom",
          buttonZoomingHTML: 'Drag a region on the map (click here to reset)',
          buttonZoomingStyle: {background:"yellow"},
          backButtonHTML: "Drag Zoom Back",  
          backButtonStyle: {display:"none",marginTop:"3px",background:"#FFFFC8"},
          backButtonEnabled: true, 
          overlayRemoveTime: 1500} 
        var callbacks = {backbuttonclick:function(methodCall){restoreContextCallback(methodCall)}}
        map.addControl(DragZoom = new DragZoomControl({}, otherOpts, callbacks), 
          new GControlPosition(G_ANCHOR_TOP_LEFT, new GSize(7,7)));

        addBoroughLabels();  // Add a label for each borough centered on that borough and load into the Marker Manager
        addParkMarkers();    // Add a marker for the parks near the center of each borough and load into the Marker Manager
        markerMgr.refresh(); // Turn everything on
      }
    }

    //]]>
    </script>
  </head>
  <body onload="load()" onunload="GUnload()">
    <table width=80% style="text-align:left;border:1px solid black"><tr><td style="font:16pt Ariel">
      Illustrating the integration of an application specific zoom method with the DragZoom control
    </td></tr><tr><td style="font:13.5pt">
      - The map shows Greater New York. Use The DragZoom Button in the top left and select a rectangle encompassing New York City 
      (about 1/4 of the map area).<br>
      - Labels for the 5 boroughs should appear. Click on one of the 5 borough labels.<br>
      - You should now see a closeup of that borough with several park markers.  Click on one of the park markers.<br>
      - Do another DragZoom (don't click the back button yet) to magnify the park area.<br>
      - Now start clicking the DragZoom back button.  It will take you back through the sequence.<br><br style="font:4pt">
      Play around, zooming in and out using the DragZoom and the Borough Zoom.<br>
    </td></tr></table>
    <p>
    <div id="map" style="width: 900px; height: 600px; border:1px solid black"></div>

  </body>
</html>