<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>ExtInfoWindow Example: Blog Example</title>

    <link type="text/css" rel="Stylesheet" media="screen" href="css/rssWindow.css"/>

    <script type="text/javascript"  src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAjU0EJWnWPMv7oQ-jjS7dYxQGj0PqsCtxKvarsoS-iqLdqZSKfxRdmoPmGl7Y9335WLC36wIGYa6o5Q">
    </script>
    <script src="../src/extinfowindow.js" type="text/javascript"></script>
    <script type="text/javascript">
      var map;
      function load() {
        if (GBrowserIsCompatible()) {
          map = new GMap2(document.getElementById("map"));
          map.setCenter(new GLatLng(44, -96), 4);
          map.addControl(new GLargeMapControl());

          marker = new GMarker( new GLatLng(44, -96) );
          GEvent.addListener(marker, 'click', function(){ 
            marker.openExtInfoWindow(
              map,
              "rss_window",
              "Loading...",
              {
                beakOffset: 3, 
                ajaxUrl: "rss.xml", 
                foo: callbackFunction
              }
            ); 
          });
          map.addOverlay(marker);
          
          GEvent.addDomListener(map, 'extinfowindowupdate',function(){
           
          });
        }
      }
      function callbackFunction(){
        //this is a rather ugly way of scraping the rss feed we supplied above to grab all the titles and display only
        //those in the info window
        var windowContent = document.getElementById("rss_window_contents");
        var entries = windowContent.innerHTML.split("<entry>");
        var newHTML = "<ol>";
        var entriesLength= entries.length > 10 ? 10 : entries.length;
        for( i=0; i < entriesLength; i++ ){
          var entry = entries[i];
          var title = entry.substring( entry.indexOf("<title"), entry.indexOf("</title>") );
          var title_contents = title.substring( title.indexOf(">")+1, title.length);
          console.log(title_contents);
          newHTML += "<li>" + title_contents+ "</li>";
        }
        newHTML += "</ul>";
        windowContent.innerHTML ="<div>" + newHTML + "</div>";
        map.getExtInfoWindow().resize();
      }
    </script>
  </head>
  <body onload="load()" onunload="GUnload()">
    <div id="map" style="width: 900px; height: 600px" ></div>
  </body>
</html>