<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>ExtInfoWindow Example: extinfowindowupdate event</title>

	  <link type="text/css" rel="Stylesheet" media="screen" href="css/redInfoWindowTabs.css"/>
	  <style type="text/css">
	    .event_status{
	      border: 1px solid #000;
	      width: 200px;
	      min-width: 200px;
	    }
    	#map{
    		width: 49%;
    		height: 500px;
    		float: left;
    	}
    	#demo_explanation{
    		border-right: 1px solid #000;
    		float: left;
    		width: 49%;
    		margin-right: 5px;
    		padding-right: 5px;
    		font-size: .9em;
    	}
    	pre{
    	  height: 200px;
    	  width: 90%;
    	  border: 1px solid #000;
    	  overflow: scroll;
    	}
    </style>

    <script type="text/javascript" src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAjU0EJWnWPMv7oQ-jjS7dYxQGj0PqsCtxKvarsoS-iqLdqZSKfxRdmoPmGl7Y9335WLC36wIGYa6o5Q"></script>
	<script src="../src/extinfowindow.js" type="text/javascript"></script>

  <script type="text/javascript">
		var map2;
    function load() {
      if (GBrowserIsCompatible()) {
        map2 = new GMap2(document.getElementById("map"));
        map2.setCenter(new GLatLng(39, -96), 4);
        map2.addControl(new GLargeMapControl());

        //marker with ext info window with a red skin
        var redIcon1 = new GIcon(G_DEFAULT_ICON);
        redIcon1.iconAnchor = new GPoint(0, 0);
        redIcon1.infoWindowAnchor = new GPoint(7, 0 );

        marker = new GMarker( new GLatLng(32, -100), redIcon1);
        GEvent.addListener(marker, 'click', 
          function(){ 
            marker.openExtInfoWindow(
              map2,
              "custom_info_window_red",
              "<p>Loading Tabs...</p>",
              {beakOffset: 3, ajaxUrl: 'ajax/ajaxTabs.html'}
            ); 
          }
        );
        GEvent.addListener(map2, 'extinfowindowupdate',function(){
          /**
           * Anonymous function to parse through the HTML pulled back from the 
           * ExtInfoWindow's Ajax request.
           */
          var windowContent = document.getElementById("custom_info_window_red_contents");
          
          //grab the DOM elements that will become the tabs
          var tabs = new Array(document.getElementById("tab0"),document.getElementById("tab1"));
          if( tabs.length > 0 ){
            
            //intialize each tab's content section. Show the first tab's content, and hide the others
            var tabContentsArray = new Array(tabs.length);
            for( i=0; i < tabs.length; i++){
              tabContentsArray[i] = document.getElementById("tab"+i+"_content");
              if( i > 0){
                hide(tabContentsArray[i]);
              }
              tabs[i].setAttribute("name", i.toString());
              
              //Add event listener for mouse clicks on each tab
              GEvent.addDomListener(tabs[i],"click",function(e){
                /**
                 * Anonymous function to handle the clicked tab
                 * @param {Object} e The DOM element that was clicked
                 */
                 
                //Determine what tab was clicked.
                eventElement = e.currentTarget;
                var tabIndex = eventElement.getAttribute("name");
                
                //Loop through the tab content DOM elements, showing the contents 
                //associated to the clicked tab, and hiding the rest
                for(tabContentIndex=0; tabContentIndex < tabs.length; tabContentIndex++){
                  if( tabContentIndex == tabIndex ){
                    show(tabContentsArray[tabContentIndex]);
                  }else{
                    hide(tabContentsArray[tabContentIndex]);
                  }
                }
                
                //resize the info window in case the new tab's contents is taller
                //or shorter than the previous contents
                map2.ExtInfoWindowInstance.resize();
              });
            }
          }
        });
        map2.addOverlay(marker);
      }
    }
		/**
		 * Helper function to hide the given DOM element
		 * @param {Object} element The DOM element that should be hidden
		 */
    function hide(element){
	    element.style.display = "none";
  		element.style.position = "absolute";
  	}
  	/**
		 * Helper function to show the given DOM element
		 * @param {Object} element The DOM element that should be displayed
		 */
  	function show(element){
  		element.style.display = "block";
  		element.style.position = "relative";
    }
		
  </script>
  </head>
  <body onload="load()" onunload="GUnload()">
    <h1>ExtInfoWindow Event "extinfowindowupdate"</h1>
    <div id="demo_explanation">
    	<p>
    	  This demo will illustrate how you can manipulate Ajax returned content using the "extinfowindowupdate" event.
    	</p>
    	<p>
    	  In this case, we will listen for "extinfowindowupdate" on <code>GMap2</code>. When you click on the maker on the map, the ExtInfoWindow is opened and kicks off an Ajax request to the local url "ajax/ajaxTabs.html".  Upon completion of injecting that file's HTML contents into the info window, the map fires the "extinfowindowupdate" event.  Our listener in this demo picks up that the event has occurred and begins to manipulate the returned HTML.  By locating certain DOM ids and class names, we can then simulate a tabbed interface for the info window.
    	</p>
    	<p>
    	  The exact HTML returned from our Ajax request will be:
    	  <pre>
&lt;div id="" class="tabs">
  &lt;div class="tabs_header">
    &lt;div id="tab0" class="tab first">&lt;span>Tab1&lt;/span>&lt;/div>
    &lt;div id="tab1" class="tab last">&lt;span>Tab2&lt;/span>&lt;/div>
  &lt;/div>
  &lt;div class="tab_contents">
    &lt;div id="tab0_content">
      &lt;div class="title">Tab 1: intro&lt;/div>
      &lt;p>
        This is the contents of Tab 1. We created this by listening
        for the "extinfowindowupdate" event on the GMap2 object and 
        manipulating the returned HTML. In this case, we manipulated 
        the returned HTML to creat the effects of tabs.
      &lt;/p>
      &lt;p>
        Notice if you click Tab 2 above you will get some other 
        contents to appear in this area.
      &lt;/p>
    &lt;/div>
    &lt;div id="tab1_content">
    &lt;div class="title">Tab 2: tabs continued &lt;/div>
      &lt;p>
        Well look at you, clicking tabs to get different content!
      &lt;/p>
      &lt;p>
        Take note that all this content was originally pulled from an ajax 
        request so it won't bog down load time.
      &lt;/p>
      &lt;p>
        Also note that when we set up the tabs we called ExtInfoWindow.resize().
        This helps in case each tab has a different height of it's contents.
      &lt;/p>
      &lt;p>
        Where to go from here? How about adding effects. You could listen 
        for the extinfowindowupdate and set up your tabs to do transitional
        effects using something like &lt;a target="_blank" href="http://script.aculo.us/">
        Scriptaculous&lt;/a> or &lt;a target="_blank" href="http://moofx.mad4milk.net/">Moo.fx&lt;/a>.  
        It's all in your control now.
      &lt;/p>
    &lt;/div>
  &lt;/div>
&lt;/div>
    	  </pre>
    	</p>
    	<p><br />
    	  The javascript function fired when "extinfowindowupdate" is found is: 
    	  <pre>
var windowContent = document.getElementById("custom_info_window_red_contents");
var tabs = new Array(document.getElementById("tab0"),
document.getElementById("tab1"));
if( tabs.length > 0 ){
  var tabContentsArray = new Array(tabs.length);
  for( i=0; i &lt; tabs.length; i++){
    tabContentsArray[i] = document.getElementById("tab"+i+"_content");
    if( i > 0){
      hide(tabContentsArray[i]);
    }
    tabs[i].setAttribute("name", i.toString());
    GEvent.addDomListener(tabs[i],"click",function(e){
      eventElement = e.currentTarget;
      var tabIndex = eventElement.getAttribute("name");
      for(tabContentIndex=0; tabContentIndex &lt; tabs.length; tabContentIndex++){
        if( tabContentIndex == tabIndex ){
          show(tabContentsArray[tabContentIndex]);
        }else{
          hide(tabContentsArray[tabContentIndex]);
        }
      }
      map2.ExtInfoWindowInstance.resize();
    });
  }
}
    	  </pre>
    	</p>
    </div>
    <div id="map"></div>
  </body>
</html>